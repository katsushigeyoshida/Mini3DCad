---  Mini3DCad  ---
プリミティブ Primitive
・基本プリミティブ
　属性 : PrimitiveId mPrimitiveId                //  種別
         FACE3D mPrimitiveFace                   //  表示面(xy,yz,zx)
         double mLineThickness                   //  線の太さ
         int mLineType                           //  線種(0:solid 1:dash 2:center 3:phantom)
         Brush mLineColor                        //  線の色
         List<Brush> mFaceColors                 //  面の色
         Brush mPickColor                        //  ピック時のカラー
         bool mPick                              //  ピック状態
         List<SurfaceData> mSurfaceDataList      //  3D座標データ
         List<List<Point3D>> mVertexList         //  2D表示用3D座標データ

　種類: 管理データ Non, Link(undo用),
        2Dデータ   Point(点), Line(線分), Arc(円弧), Polyline(折線), Polygon(多角形),
        3Dデータ   Extrusion(押出), Blend(ブレンド), Revolution(回転体), Sweep(掃引), (螺旋)
        未使用     WireCube, Cube, Cylinder, Sphere, Cone,

エレメント Element
  属性 : string mName                         　//  エレメント名(任意)
         Primitive mPrimitive                   //  プリミティブ
         List<Surface> mSurfaceList             //  サーフェスデータリスト(LINE/TRYANGLE)
         bool mBothShading                      //  両面陰面判定の有無
         bool mDisp3D                           //  3Dでの表示/非表示
         bool mRemove                           //  削除フラグ
         Box3D mArea;                           //  要素領域
         int mOperationNo                       //  操作位置
         int mLinkNo                            //  リンク先要素番号
         byte[] mLayerBit;                      //  レイヤーBit

サーフェースデータ SurfaceData
  属性 : List<Point3D> mVertexList;             //  座標点リスト
         DRAWTYPE mDrawType;                    //  描画方式
         Brush mFaceColor                       //  表面の色
  種類(描画方式 DRAWTYPE)
        POINTS, LINES, LINE_STRIP, LINE_LOOP,
        TRIANGLES, QUADS, POLYGON, TRIANGLE_STRIP,
        QUAD_STRIP, TRIANGLE_FAN, MULTI

コマンド
・作成
    点		    ロケイトした位置に点要素を作成。
    線分	    ２点ロケイトした位置に線分要素を作成。
    折線	    複数点ロケイトして折れ線要素を作成、ロケイトの終了は要素のない場所でマウスの右ボタンを押す。
    円		    １点目に中心点、２点目で半径を指定して作成。
    円弧	    １点目と２点目で円弧の端点を指定し３点目で円弧の膨らみの大きさを設定して作成。
    四角	    対角点の２点を指定して四角形を作成、作成した四角形はポリゴン要素でできている。
    ポリゴン    複数点ロケイトして多角形を作成、要素のない場所でマウスの右ボタンを押すとロケイトを終了する。
    　　　　　　作成した3D表示では平面として表示される。
    戻る
・2D編集
    移動		選択した要素を２点ロケイトして要素を移動する。
    回転		選択した要素を１点目を中心にして２点目から３点目に要素を回転する。
    オフセット	選択した要素を２点ロケイトして要素を平行移動させる。
    反転		選択した要素を２点ロケイトした点を結ぶ線分を基準に反転移動させる。
    トリム	    選択した要素で線分、円弧、折れ線のみ２点ロケイトした位置で長さを再設定する。
    拡大・縮小
    ストレッチ  
    分解        
    分割	    選択した要素で線分、円弧、折れ線はロケイトした位置を基準に２つの要素に分ける。
    　　　　　　ポリゴンの場合はロケイトした位置で切断して折れ線に変換する。
    接続	    選択した２要素(線分、円弧、折れ線)を接続して一つの折れ線要素に変換する。
    　　　　　　選択した要素が１要素(円弧、折れ線)の場合は端点同士を接続してポリゴン要素に変換する。
    戻る
・2Dコピー
    移動		選択した要素をコピーしコピーした要素を2点ロケイトで移動する
    回転	    選択した要素をコピーしコピーした要素をロケイトの１点目を中心にして２点目から３点目に要素を回転する。
    オフセット	選択した要素をコピーしコピーした要素を２点ロケイトして要素を平行移動させる。
    反転	    選択した要素をコピーしコピーした要素を２点ロケイトした点を結ぶ線分を基準に反転移動させる。
    トリム	    選択した要素をコピーしコピーした要素で線分、円弧、折れ線のみ２点ロケイトした位置で長さを再設定する。
    要素コピー
    要素ペースト
    戻る
・3D編集
    押出	    線分、折れ線またはポリゴンを作成した面とは別の面で選択し、[押出]コマンドを選択して２点ロケイトする
    　　　　　　ことでロケイトした方向に引き延ばして3D化する。線分の場合は単なる平面となる。
    　　　　　　ポリゴンの場合は両端が塞がれた形となる。
    ブレンド    ２つの断面形状(ポリゴン)を結合して3D形状を作成する
    回転体	    回転の中心線となる線分と外形線となる折れ線を選択してこのコマンドを選択すると外形線なる要素を線分を
    　　　　　　中心に一周まわした形状を作成する。
    掃引	    ２本の折れ線に沿って円を掃引して3Dデータを作成するので２本の折れ線を選択してこのコマンドを実行する。
    　　　　　　選択する折れ線は折れ点が同じである必要がある。
    螺旋
    解除	    押出、回転体、掃引でできた要素をピックしてこのコマンドを実行することにより、3D化する前の状態に戻す。
    戻る
・設定
    図面コメント
    表示レイヤ      レイヤ名一覧: 追加、変更、削除、表示/非表示
    グループ設定    グループ名一覧: 追加、変更、表示/非表示
    属性変更　	    選択した要素に対してダイヤログを表示して色や線種などの属性を変更する
    一括属性変更	選択した複数の要素に対してダイヤログを表示し、チェックを入れた項目のみまとめて属性を変更する
・測定
    距離
    角度
    距離・角度
・情報		    選択した要素の属性などの情報を表示する。
・削除		    選択した要素を削除する。
・アンドゥ	    ひとつ前の操作状態にする。
・ツール
　　画面コピー	作図領域の画面をクリップボードにコピーする
    画面保存    作図領域の画面をファイルに保存
    イメージトリミング
・キャンセル	ピックやロケイト、コマンドなどをキャンセルする。
・終了		    データを保存してアプリを終了する。

表示機能
・タブ切替
・2D表示
  拡大縮小、スクロール(イメージコピー)、ドラッギング(イメージコピー)、ピック表示(イメージコピー)、
・3D表示
  サーフェースデータ変換、光源設定

ファイル操作
・大分類コンボボックス
  追加、名前の変更、削除
・分類リスト
  追加、名前の変更、削除、コピー、移動
・図面リスト
  追加、名前の変更、削除、コピー、移動、プロパティ


キー入力コマンド
  コマンド
    point
    line
    rect
    arc
    circle
    polyline
    polygon
  対応パラメータ
    x〇y〇           2D絶対座標
    dx〇,dy〇        2D相対座標
    x〇y〇z〇        3D絶対座標
    dx〇dy〇dz〇    3D相対座標
    p〇              要素番号
    r〇              半径
    sa〇             開始角
    ea〇             修了角
    "〇〇"           文字列
    〇〇             数値(IsDogit,-)


マウス操作

キー操作
・2D表示
  ESC             キャンセル
  F1              再表示
  F2              領域拡大
  F3              全体表示
  F4              拡大表示
  F5              縮小表示
  F7              領域ピック
  Apps(右Winキー) ロケイトメニュー
  ESC             キャンセル
  Back            ロケイト点を一つ戻す
  Ctrl + F1       グリッド0n/0ff
  Ctrl + Left     左視点移動
  Ctrl + Right    右視点移動
  Ctrl + Up       上視点移動
  Ctrl + Down     下視点移動
  Ctrl + PageUp   拡大
  Ctrl + PageDown 縮小
  Ctrl + s        ファイル保存
  Ctrl + z        アンドゥ
・3D表示
  Left            Y軸で回転
  Right           Y軸で回転
  Up              X軸で回転
  Down            X軸で回転
  PageUp          Z軸で回転
  PageDown        Z軸で回転
  End             縮小
  Shift + End     拡大
  Ctrl + Left     左に移動
  Ctrl + Right    右に移動
  Ctrl + Up       上に移動
  Ctrl + Down     下に移動
  Ctrl + PageUp   前に移動
  Ctrl + PageDown 後に移動
  Ctrl + End      回転を初期化

ロケイト・ピック操作
・ピック             Ctrl + マウス右ボタン
  領域ピック         F7 → 2点ロケイト
  複数ピック選択
  アンピック          ピックした要素
  グループピック       Ctrl + マウス右ボタン
・ロケイト(基準面/要素上)
  自動ロケイト        ロケイトモードでマウス右ボタン (端点、中点、1/4点、交点)
  ピックメニュー      Ctrl + マウス右ボタン メニュー選択
                      端点・中間点, 3分割点, 4分割点, 5分割点, 6分割点, 8分割点, 垂点, 中心点, 頂点,交点
  キーピックメニュー  Appsキー　
                      座標入力, 相対座標入力、平行距離, 半径, 回転角, 

  基準面              要素上の座標を指定するときに基準面に投影した座標(XY面であればZ=0)と要素上の座標との選択

データファイル
・ファイル : CSV形式
・図面データ
・コマンド履歴

システム設定
・円の分割角度、回転体の分割角度、掃引の円分割角度
・データ保存フォルダ

その他の機能
・自動保存 操作回数10回ごとに保存  [CommandOpe(mSaveOperationCount)]
・変更ないデータの保存回避 読み込んだ時のデータ数と保存時のデータ数が同じであれば保存しない [DataManage]

R面コマンドの仕様
　ポリライン要素とポリゴン要素のみ
　頂点部をR面値(画面上部のツールバー右)に合わせせてフィレット処理(R面)をおこなう

接続コマンド仕様
・1要素選択
　円弧: 端点同士を線分で接続してポリゴン要素に変換
　円: 4点の座標点でポリゴン要素に変換
　ポリライン: 端点同士が離れている時は接続してポリゴン要素に変換
・2要素選択
　2要素が交差している時は交点でトリムして1要素のポリライン要素に変換(ピック側を残す)
　2要素が交差していない場合には延長線の交点で接続して1要素のポリラインに変換する
　更に延長線の交点がない場合はピック位置に近い端点同士を線分で接続して1要素のポリラインに変換する
・複数要素選択
　3要素以上を選択した場合には選択した順に隣り合う要素で近い端点同士を接続して1要素のポリラインに変換する

問題点
・コマンドをイメージトリミング実行後、キャンセル(ESC)した時メインコマンドに戻っていない
・データの移動後に新規図面名の入力要求となる
・3D表示で光源と色の関係がよくない
　面ごとに法線の向きや設定などに問題あり

・要素作成のドラッギング中で背景色がクリアされる (2024/06/29)
・接続コマンドで互いの要素が同一平面上にないときの動作が不明 → 先にピックした要素の平面に投影する (2024/06/27)
・円弧を含めた閉領域を作成した場合、円弧を折線に変換するため再編集がしにくい → ポリゴンの代用として複合要素が必要
　とりあえずは線分と円弧で3D化するとき(平面を含めて)ポリライン、ポリゴンに変換する
　またはボライン、ポリゴンの中に再編集用の円弧データを持つ　(2024/05/19)
・コピーコマンドで複数座標指定要 (2024/03/23)
・ポリゴンの表裏の変換方法を見直す必要(現状は反時計回りに固定) → SurfaceDataの段階で回転方向を変換(2024/03/13)
・ポリゴンの３角形分割のバグ (2024/03/11)
・回転体などがあるとピックに時間がかかる → Element単位での篩(クリッピング)が必要(既に対応済み)
・線分同士の接続を平面図では作成面がおかしい (bug 2024/02/25)
・回転要素や掃引要素があると2D再表示/拡大縮小に時間がかかる → VertexListを外形線にして簡素化し改善 (2024/02/20)
・回転要素や掃引要素があるとピックに時間がかかる → SurfaceDataListをVertexListにすることで改善 (2024/02/20)
・2D表示でポリゴンの分割三角形の表示をさせない → 分割三角形の表示があると2Dで平面と認識できる → 外形線(VertexList)を使うことでなくす
・押出/回転/掃引での移動/回転のドラッギング表示が遅い(特に円) → ドラッギング時は外形線を表示することとで対応
・ローティトしたポリゴンによる押出が回転前のデータで処理される → 2D平面を使うように変更(2024/02/09)
・Face面の切り替え直後のスクロールでBitmapがクリアされている → Bitmapの有無を判断するようにした(2024/02/07)
・ExtrusionやRevolutionを2Dで回転させるとVertexListの再作成でこける、作成面で再作成できないものがある
　→　translateやrotateでは SurfaceDataListを直接座標変換するように修正(2024/02/05)
・ポリゴンで特定の線がピックできない(済)
・3D表示状態で図面を切り替えたときに3D表示が更新されない → 図面を切り替えた時の初期表示をXY面にする(2024/02/08)
・色変更をした直後、3D表示に反映されない(済)
・OpenGLのポリゴン面が凹型に対応していない → ポリゴンを3角形にリストに変換する(2024/0208)
・3D表示にFaceColorのListデータが反映されない(代わりにLineColorを使用)
・回転体の作成でFaceColorが引き継がれない、ファイルを読み直す反映される(済)

機能追加、改善
・パラメトリック機能をグループ化(拘束条件とグループ属性)
・WebGLへのデータ出力(不要)、OBJファイルの方が使えそう
・XYZ軸表示の表示/非表示設定
・パース図(xyz面)の追加
・ユーザープロット関数、ユーザー関数
・2D専用の文字要素
・複数線分要素(文字データ、直方体など)外部データ化(シンボル機能の一種)
・2Dでの寸法線機能(文字要素の追加必要)

・面に対する反転処理(mirror)が必要 (2024/06/30)
・ワイヤーフレームのサポート(2024/06/27)
・パーツ機能(パーツ化、分解、登録) ← 不要
・2D編集に3Dデータのストレッチコマンド用(頂点と辺) (2026/06/26)
・3D要素でアウトラインデータの表示を追加し編集させる (2024/06/26)
・属性変更ダイヤログでレイヤー名の追加必要 (2024/06/22)
・ポリラインとポリゴンに円弧座標追加(保存読出、ストレッチ、オフセット、トリム、分割、接続、押出) (2024/06/02)
・コマンドのリストの実行結果をコマンドに登録 (済)
・ストレッチコマンド (2024/03/29)
・複数ピックによる接続　(2024/03/29)
・要素のコピー&ペーストでレイヤー対応 (2024/03/15)
・データベースの識別子の追加 → DataManage,AppName を追加 (2024/03/13)
・バックアップ機能 (2024/03/13)
・図面間の要素データコピー(ClipBoard経由) (2024/03/10)
・拡大縮小コマンド (2024/03/05)
・要素の非表示機能またはレイヤ機能 (2024/03/02)
・2D機能としてアンピックと一括属性変更、ダブルクリックによる属性変更 (2024/02/25)
・2Dでのトリム機能(現状は分割機能で代用) (2024/02/28)
・タブ切り替え時のWindowsWorldサイズの保持 (2024/02/15)
・2Dでの反転機能 (2024/02/24)
・2Dでのオフセット機能 (2024/02/15)
・回転体でスィープ敵機能を追加 → スィープコマンドを追加 (2024/02/15)
・2Dでの線種の設定 (2024/02/20)
・キーコマンドの作成(2024/02/11 line/circle/arc/polyline/polygon追加)
・データ保存場所の設定機能 (2024/02/20 システム設定)
・3D機能(押出、回転など)の解除機能(線分、ポリライン、ポリゴンなどに戻す) → 解除(release)機能を追加(2024/02/08)

使い方のノウハウ
・2D編集
  指定した要素を線分に平行に移動するには移動する要素の位置を指定し移動先の線分要素に対してCtrl+右ピックで垂点を選択する
  編集をしやすくするため個々の要素にレイヤーを設定し編集に関係のない要素をレイヤで飛彪時にしておこなう。要素が重なるときに特に有効


GitHubの登録
echo "# Mini3DCad" >> README.md
git init
git add README.md
git commit -m "first commit"
git branch -M main
git remote add origin https://github.com/katsushigeyoshida/Mini3DCad.git
git push -u origin main